\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath, amsthm, amssymb}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{geometry}
\geometry{margin=1in}

% Define colors for Lean syntax highlighting
\definecolor{leanKeyword}{RGB}{0, 0, 255}       % Blue for keywords
\definecolor{leanType}{RGB}{139, 0, 139}        % Dark magenta for types
\definecolor{leanString}{RGB}{0, 128, 0}        % Green for strings
\definecolor{leanComment}{RGB}{128, 128, 128}   % Gray for comments
\definecolor{leanDefinition}{RGB}{255, 140, 0}  % Dark orange for definitions
\definecolor{leanAttribute}{RGB}{255, 20, 147}  % Deep pink for attributes
\definecolor{leanBackground}{RGB}{250, 250, 250} % Light gray background

% Define Lean language for listings
\lstdefinelanguage{Lean}{
  % Keywords
  morekeywords=[1]{def, theorem, lemma, instance, class, structure, inductive,
    axiom, constant, variable, namespace, section, noncomputable, protected,
    private, abbrev, example, open, attribute, local, mutual, by, where,
    extends, deriving, end, import, prelude, theory, with, without, using,
    match, if, then, else, fun, have, show, from, let, in, do, begin, calc},
  % Types and Type constructors
  morekeywords=[2]{Type, Prop, Sort, Nat, Int, Bool, String, Char, List,
    Option, Unit, Prod, Sum, Sigma, Subtype, Set, Scheme, CommRingCat,
    AffineScheme, Opens, IsAffine, IsAffineOpen, Spec, Category, Functor,
    Iso, IsIso, CompactSpace, IsCompact, IsOpenImmersion, Equiv, Hom, LocallyRingedSpace,
    TopCat, SheafedSpace, PresheafedSpace, PrimeSpectrum, StructureSheaf, Localization,
    IsLocalRing, Subring, LocalPredicate, PrelocalPredicate, Adjunction},
  % Tactics (if they appear)
  morekeywords=[3]{simp, rfl, exact, apply, intro, cases, induction, refl,
    constructor, assumption, contradiction, trivial, sorry, admit, rw,
    convert, infer_instance, ext, rintro, obtain, refine, dsimp, rcases, grind,
    have, change, erw},
  % Sensitive
  sensitive=true,
  % Comments
  morecomment=[l]{--},
  morecomment=[n]{/-}{-/},
  % Strings
  morestring=[b]",
  % Style
  keywordstyle=[1]\color{leanKeyword}\bfseries,
  keywordstyle=[2]\color{leanType}\bfseries,
  keywordstyle=[3]\color{leanDefinition}\itshape,
  commentstyle=\color{leanComment}\itshape,
  stringstyle=\color{leanString},
  % Highlight attributes
  moredelim=[is][\color{leanAttribute}]{@[}{]},
  moredelim=[is][\color{leanAttribute}]{\#[}{]},
}

\lstset{
  language=Lean,
  basicstyle=\ttfamily\small,
  backgroundcolor=\color{leanBackground},
  breaklines=true,
  frame=single,
  framerule=0.5pt,
  rulecolor=\color{gray!30},
  numbers=left,
  numberstyle=\tiny\color{gray},
  numbersep=5pt,
  showstringspaces=false,
  prebreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\hookleftarrow}},
  breakindent=25pt,
  captionpos=b,
  xleftmargin=10pt,
  framexleftmargin=10pt,
  % Unicode replacements for mathematical symbols
  literate={Œì}{{$\Gamma$}}1
           {‚ä§}{{$\top$}}1
           {‚ü∂}{{$\to$}}2
           {‚âÖ}{{$\cong$}}1
           {‚äÜ}{{$\subseteq$}}1
           {‚®Ü}{{$\bigsqcup$}}1
           {‚àà}{{$\in$}}1
           {‚àÉ}{{$\exists$}}1
           {‚àß}{{$\land$}}1
           {‚Åª¬π·µÅ}{{$^{-1}U$}}3
           {‚Åª¬π}{{$^{-1}$}}2
           {‚â´}{{>>}}1
           {‚â§}{{$\leq$}}1
           {·µí·µñ}{{$^{op}$}}2
           {‚•§}{{$\Rightarrow$}}2
           {‚âå}{{$\simeq$}}1
           {‚ãô}{{$\ggg$}}1
           {‚àÄ}{{$\forall$}}1
           {‚Üë}{{$\uparrow$}}1
           {ùí∞}{{$\mathcal{U}$}}1
           {ùüô}{{$\mathbb{1}$}}1
           {''·µÅ}{{''U}}2
           {‚â™‚â´}{{$\ll\gg$}}2
           {Œπ}{{$\iota$}}1
           {‚Üí}{{$\to$}}1
           {·µÅ}{{U}}1
           {:=}{{$\mathrel{:=}$}}2
           {√ó}{{$\times$}}1
           {‚ß∏}{{$/\!/$}}1
           {‚Üî}{{$\leftrightarrow$}}1
           {‚ü®}{{$\langle$}}1
           {‚ü©}{{$\rangle$}}1
           {Œ±}{{$\alpha$}}1
           {Œ≤}{{$\beta$}}1
           {Œ≥}{{$\gamma$}}1
           {Œ¥}{{$\delta$}}1
           {Œµ}{{$\varepsilon$}}1
           {Œª}{{$\lambda$}}1
           {Œº}{{$\mu$}}1
           {œÉ}{{$\sigma$}}1
           {œÑ}{{$\tau$}}1
           {œÜ}{{$\varphi$}}1
           {œà}{{$\psi$}}1
           {œâ}{{$\omega$}}1
           {‚àû}{{$\infty$}}1
           {‚àÇ}{{$\partial$}}1
           {‚àá}{{$\nabla$}}1
           {‚äì}{{$\sqcap$}}1
           {‚ä£}{{$\dashv$}}1
}

\theoremstyle{definition}
\newtheorem{definition}{Definition}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{instance}{Instance}

\title{The Œì-Spec Adjunction in Mathlib4\\
\large A Companion to \texttt{GammaSpecAdjunction.lean}}
\author{}
\date{}

\begin{document}
\maketitle

\section{Introduction}

This document provides a natural language companion to the \texttt{GammaSpecAdjunction.lean} file in Mathlib4. The file establishes the fundamental adjunction between the global sections functor $\Gamma$ and the spectrum functor $\mathrm{Spec}$, which is one of the cornerstones of algebraic geometry.

The adjunction $\Gamma \dashv \mathrm{Spec}$ captures the duality between geometry and algebra: geometric objects (locally ringed spaces/schemes) correspond to algebraic objects (commutative rings) via this adjunction. This relationship is at the heart of the philosophy that "geometry is dual to algebra."

\section{Mathematical Background}

The adjunction establishes that for any locally ringed space $X$ and commutative ring $R$:
$$\text{Hom}(X, \mathrm{Spec}(R)) \cong \text{Hom}(R, \Gamma(X, \mathcal{O}_X))$$

This means that morphisms from a locally ringed space to an affine scheme are in natural bijection with ring homomorphisms from the ring to the global sections of the space.

Since we're working with contravariant functors, the adjunction is technically between $\Gamma^{\text{op}}$ and $\mathrm{Spec}$, or equivalently $\mathrm{Spec}^{\text{op}} \dashv \Gamma$.

\section{The Unit: Canonical Map to Spec of Global Sections}

\subsection{Construction of the Underlying Map}

\begin{lstlisting}
def toŒìSpecFun : X ‚Üí PrimeSpectrum (Œì.obj (op X)) := fun x =>
  PrimeSpectrum.map (LocallyRingedSpace.Œì.map X.toŒìSpec.c.app (op ‚ä§)) x.1
\end{lstlisting}

\textbf{Natural Language:} For any locally ringed space $X$, we construct a continuous map from $X$ to $\mathrm{Spec}(\Gamma(X, \mathcal{O}_X))$. Each point $x \in X$ maps to the prime ideal that is the kernel of the composition of the stalk map $\Gamma(X, \mathcal{O}_X) \to \mathcal{O}_{X,x}$ with the natural map to the residue field.

\subsection{Relationship with Stalks and Units}

\begin{lstlisting}
theorem notMem_prime_iff_unit_in_stalk (r : Œì.obj (op X)) (x : X) :
    r ‚àâ X.toŒìSpecFun x ‚Üî IsUnit (X.presheaf.germ (‚ü®x, trivial‚ü© : X.basicOpen r) r)
\end{lstlisting}

\textbf{Natural Language:} A global section $r$ is not in the prime ideal corresponding to point $x$ if and only if $r$ becomes a unit in the stalk at $x$. This captures the fundamental relationship between the algebraic (prime ideal) and geometric (stalk) perspectives.

\subsection{Basic Opens and Preimages}

\begin{lstlisting}
theorem toŒìSpec_preimage_basicOpen_eq (r : Œì.obj (op X)) :
    X.toŒìSpecFun ‚Åª¬π' PrimeSpectrum.basicOpen r = X.basicOpen r
\end{lstlisting}

\textbf{Natural Language:} The preimage of a basic open set $D(r)$ in $\mathrm{Spec}(\Gamma(X, \mathcal{O}_X))$ under the canonical map is exactly the basic open set $D(r)$ in $X$. This shows that the map respects the basic open sets, which are fundamental to the topology.

\subsection{Continuity}

\begin{lstlisting}
theorem toŒìSpec_continuous : Continuous X.toŒìSpecFun := by
  rw [continuous_iff_isClosed]
  intro S hS
  rw [‚Üê PrimeSpectrum.isClosed_zeroLocus_iff] at hS
  obtain ‚ü®T, rfl‚ü© := hS
  simp only [toŒìSpecFun, ‚Üê Set.preimage_setOf_eq, PrimeSpectrum.mem_zeroLocus]
  rw [X.toŒìSpec_preimage_zeroLocus_eq T]
  exact X.zeroLocus_isClosed T
\end{lstlisting}

\textbf{Natural Language:} The canonical map $X \to \mathrm{Spec}(\Gamma(X, \mathcal{O}_X))$ is continuous. This is shown by proving that preimages of closed sets (zero loci) are closed.

\section{Sheaf Morphism Construction}

\subsection{Component Apps on Basic Opens}

\begin{lstlisting}
def toŒìSpecCApp :
    (structureSheaf (Œì.obj (op X))).1.obj (op (basicOpen r)) ‚ü∂
    X.presheaf.obj (op (X.basicOpen r)) :=
  -- Complex construction involving localizations and restrictions
\end{lstlisting}

\textbf{Natural Language:} For each basic open $D(r)$ in $\mathrm{Spec}(\Gamma(X, \mathcal{O}_X))$, we need to construct compatible maps from the structure sheaf to the pullback of $X$'s presheaf. This involves carefully handling localizations and the relationship between basic opens.

\subsection{Compatibility Conditions}

\begin{lstlisting}
theorem toŒìSpecCApp_spec : toOpen _ (basicOpen r) ‚â´ X.toŒìSpecCApp r = X.toToŒìSpecMapBasicOpen r :=
\end{lstlisting}

\textbf{Natural Language:} The constructed sheaf maps are compatible with the natural inclusions of ring elements into localizations. This ensures that our construction respects the ring structure.

\section{The Complete Unit Morphism}

\subsection{As a Morphism of Locally Ringed Spaces}

\begin{lstlisting}
def toŒìSpec : X ‚ü∂ Spec.locallyRingedSpaceObj (Œì.obj (op X)) where
  -- Underlying continuous map
  base := X.toŒìSpecBase
  -- Sheaf morphism  
  c := X.toŒìSpecSheafedSpace.c
  -- Proof that stalk maps are local ring homomorphisms
  isLocalAtTarget := -- proof
\end{lstlisting}

\textbf{Natural Language:} The complete unit morphism $X \to \mathrm{Spec}(\Gamma(X, \mathcal{O}_X))$ consists of the continuous map we constructed plus a compatible sheaf morphism. The additional requirement is that the induced stalk maps are local ring homomorphisms.

\subsection{Stalk Map Properties}

\begin{lstlisting}
theorem toStalk_stalkMap_toŒìSpec (x : X) :
    toStalk _ (X.toŒìSpecFun x) ‚â´ X.toŒìSpec.stalkMap x = X.presheaf.germ ‚ü®x, trivial‚ü©
\end{lstlisting}

\textbf{Natural Language:} The stalk maps induced by the unit morphism are compatible with the natural germ maps. This ensures that local information is preserved under the unit morphism.

\section{Compatibility with Zero Loci}

\begin{lstlisting}
lemma toŒìSpec_preimage_zeroLocus_eq {X : LocallyRingedSpace.{u}}
    (S : Set (Œì.obj (op X))) :
    X.toŒìSpecFun ‚Åª¬π' PrimeSpectrum.zeroLocus S = X.zeroLocus S
\end{lstlisting}

\textbf{Natural Language:} The unit morphism preserves zero loci: the preimage of $V(S)$ in $\mathrm{Spec}(\Gamma(X, \mathcal{O}_X))$ is exactly $V(S)$ in $X$. This is a crucial compatibility that ensures the morphism respects the closed subspace structure.

\section{Triangle Identities}

\subsection{Left Triangle (Œì-Spec-Œì Identity)

\begin{lstlisting}
theorem Œì_Spec_left_triangle : toSpecŒì (Œì.obj (op X)) ‚â´ X.toŒìSpec.c.app (op ‚ä§) = ùüô _ := by
  rw [‚Üê toOpen_comp_toŒìSpecCApp]
  exact toŒìSpecCApp_spec _ (Set.mem_univ _) ‚ü®‚ä§, le_rfl‚ü©
\end{lstlisting}

\textbf{Natural Language:} One of the triangle identities for the adjunction: composing the natural isomorphism $R \cong \Gamma(\mathrm{Spec}(R), \mathcal{O})$ with the unit at $\mathrm{Spec}(R)$ gives the identity. This expresses that "Spec undoes Gamma" on affine objects.

\subsection{Right Triangle (Spec-Œì-Spec Identity)}

\begin{lstlisting}
theorem right_triangle (R : CommRingCat) :
    Spec.locallyRingedSpaceObj R.toŒìSpec ‚â´ 
    LocallyRingedSpace.SpecŒìIdentity.hom.app R = ùüô _
\end{lstlisting}

\textbf{Natural Language:} The other triangle identity: composing the unit at a ring $R$ with the counit gives the identity on $R$. This expresses that "Gamma undoes Spec" on rings.

\section{The Adjunctions}

\subsection{Locally Ringed Space Level}

\begin{lstlisting}
def locallyRingedSpaceAdjunction : Œì.rightOp ‚ä£ Spec.toLocallyRingedSpace.{u} where
  unit := identityToŒìSpec
  counit := LocallyRingedSpace.SpecŒìIdentity.inv
  left_triangle := left_triangle
  right_triangle := right_triangle
\end{lstlisting}

\textbf{Natural Language:} The adjunction between $\Gamma^{\text{op}}$ and $\mathrm{Spec}$ at the level of locally ringed spaces. The unit is the canonical map we constructed, and the counit is the natural isomorphism between rings and global sections of their spectra.

\subsection{Scheme Level}

\begin{lstlisting}
def adjunction : Scheme.Œì.rightOp ‚ä£ Scheme.Spec.{u} where
  unit := 
  { app := fun X ‚Ü¶ ‚ü®locallyRingedSpaceAdjunction.{u}.unit.app X.toLocallyRingedSpace‚ü©
    naturality := fun X Y f => 
      Scheme.Hom.ext' (locallyRingedSpaceAdjunction.{u}.unit.naturality f.toLRSHom) }
  counit := locallyRingedSpaceAdjunction.counit
  left_triangle := -- lifting of locally ringed space triangle
  right_triangle := -- lifting of locally ringed space triangle
\end{lstlisting}

\textbf{Natural Language:} The adjunction lifts to the level of schemes. Since schemes are a full subcategory of locally ringed spaces, the adjunction can be transported, giving us the fundamental $\Gamma \dashv \mathrm{Spec}$ adjunction in the category of schemes.

\section{Adjunction Properties and Applications}

\subsection{Home-Set Bijection}

\begin{lstlisting}
theorem adjunction_homEquiv_apply {X : Scheme} {R : CommRingCat·µí·µñ}
    (f : X ‚ü∂ Spec.obj R) :
    ŒìSpec.adjunction.homEquiv X R f = ‚ü®locallyRingedSpaceAdjunction.homEquiv X.1 R f‚ü©

lemma ŒìSpec_adjunction_homEquiv_eq {X : Scheme.{u}} {B : CommRingCat} (œÜ : B ‚ü∂ Œì(X, ‚ä§)) :
    ((ŒìSpec.adjunction.homEquiv X (op B)) œÜ.op).appTop = (Scheme.ŒìSpecIso B).hom ‚â´ œÜ
\end{lstlisting}

\textbf{Natural Language:} The adjunction provides a natural bijection between morphisms $X \to \mathrm{Spec}(R)$ and ring homomorphisms $R \to \Gamma(X, \mathcal{O}_X)$. The explicit formula shows how to translate between geometric morphisms and algebraic homomorphisms.

\subsection{Counit Properties}

\begin{lstlisting}
instance isIso_adjunction_counit : IsIso ŒìSpec.adjunction.counit := by
  apply @NatIso.isIso_of_isIso_app
  intro R
  rw [adjunction_counit_app]
  infer_instance
\end{lstlisting}

\textbf{Natural Language:} The counit of the adjunction is a natural isomorphism. This means that every commutative ring is naturally isomorphic to the global sections of its spectrum, establishing the equivalence between rings and global sections of affine schemes.

\section{Immediate Consequences}

\subsection{Fully Faithful Spec}

\begin{lstlisting}
instance Spec.fullyFaithful : FullyFaithful (LocallyRingedSpace.Spec) :=
  ŒìSpec.locallyRingedSpaceAdjunction.fullyFaithfulROfIsIsoCounit

instance Scheme.Spec.fullyFaithful : FullyFaithful Scheme.Spec :=
  ŒìSpec.adjunction.fullyFaithful_Of_IsIso_Counit
\end{lstlisting}

\textbf{Natural Language:} Since the counit is an isomorphism, the Spec functor is fully faithful. This means that the category of commutative rings (with arrows reversed) embeds as a full subcategory of locally ringed spaces/schemes.

\subsection{Reflective Subcategory}

\begin{lstlisting}
instance : IsReflectiveSubcategory LocallyRingedSpace.Spec := by
  apply IsReflectiveSubcategory.mk
  exact ‚ü®_, ŒìSpec.locallyRingedSpaceAdjunction‚ü©
  
instance : IsReflectiveSubcategory Scheme.Spec := by
  apply IsReflectiveSubcategory.mk  
  exact ‚ü®_, ŒìSpec.adjunction‚ü©
\end{lstlisting}

\textbf{Natural Language:} The image of the Spec functor (i.e., affine schemes) forms a reflective subcategory. This means every locally ringed space/scheme has a "best affine approximation" given by $\mathrm{Spec}(\Gamma(X, \mathcal{O}_X))$.

\section{Technical Lemmas and Compatibilities}

\subsection{Extension Properties}

\begin{lstlisting}
theorem comp_ring_hom_ext {X : LocallyRingedSpace.{u}} {R : CommRingCat.{u}} {f : R ‚ü∂ Œì.obj (op X)}
    {g : X ‚ü∂ Spec.locallyRingedSpaceObj R} (h : g.c.app (op ‚ä§) = f) :
    f ‚â´ X.toŒìSpec.c.app (op ‚ä§) = g.c.app (op ‚ä§) ‚â´ Spec.map f.c.app (op ‚ä§)
\end{lstlisting}

\textbf{Natural Language:} Technical compatibility results that ensure the adjunction works correctly with composition and various natural transformations. These are essential for proving the triangle identities and other properties.

\subsection{Naturality of Constructions}

\begin{lstlisting}
def identityToŒìSpec : ùü≠ LocallyRingedSpace.{u} ‚ü∂ Œì.rightOp ‚ãô Spec.toLocallyRingedSpace where
  app := LocallyRingedSpace.toŒìSpec
  naturality := -- proof that this is natural in X
\end{lstlisting}

\textbf{Natural Language:} The unit of the adjunction is natural: it commutes with morphisms of locally ringed spaces in the expected way. This naturality is crucial for the adjunction to be well-defined.

\section{Conclusion}

The $\Gamma$-$\mathrm{Spec}$ adjunction is fundamental to algebraic geometry, establishing the precise relationship between:

\begin{itemize}
\item \textbf{Geometric objects}: Locally ringed spaces and schemes  
\item \textbf{Algebraic objects}: Commutative rings
\item \textbf{Geometric morphisms}: Morphisms of locally ringed spaces/schemes
\item \textbf{Algebraic morphisms}: Ring homomorphisms (in opposite direction)
\end{itemize}

Key insights:
\begin{enumerate}
\item Every locally ringed space has a canonical map to the spectrum of its global sections
\item Every ring is naturally isomorphic to the global sections of its spectrum  
\item These relationships are functorial and satisfy compatibility conditions
\item The affine world (spectra of rings) sits inside the general world as a reflective subcategory
\end{enumerate}

This adjunction provides the foundation for understanding how algebraic properties translate to geometric properties and vice versa, making it possible to use algebraic methods to solve geometric problems and geometric intuition to understand algebraic phenomena.

\end{document}